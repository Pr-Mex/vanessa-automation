//начало текста модуля
&НаКлиенте
Перем Ванесса;

&НаКлиенте
// Структура, в которой хранится состояние сценария между выполнением шагов. Очищается перед выполнением каждого сценария.
Перем Контекст Экспорт;
 
&НаКлиенте
// Структура, в которой можно хранить служебные данные между запусками сценариев. Существует, пока открыта форма Vanessa-Behavior.
Перем КонтекстСохраняемый Экспорт;

// Делает отключение модуля
&НаКлиенте
Функция ОтключениеМодуля() Экспорт

	Ванесса = Неопределено;
	Контекст = Неопределено;
	КонтекстСохраняемый = Неопределено;

КонецФункции

&НаКлиенте
Функция ПолучитьСписокТестов(КонтекстФреймворкаBDD) Экспорт
	Ванесса = КонтекстФреймворкаBDD;
	
	ВсеТесты = Новый Массив;

	//описание параметров
	//Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,Снипет,ИмяПроцедуры,ПредставлениеТеста,ОписаниеШага,ТипШага,Транзакция,Параметр);
	
	Ванесса.ДобавитьШагВМассивТестов(ВсеТесты,"ЯЗапоминаюЗначениеПеременнойСредыВПеременную(Парам01, Парам02)","ЯЗапоминаюЗначениеПеременнойСредыВПеременную","И Я запоминаю значение переменной среды 'MY_ENV_VAR' в переменную 'ЗначениеПеременнойСреды'","Позволяет сохранить переменную среды как переменную контекста.","Переменные среды");

	Возврат ВсеТесты;
КонецФункции

&НаКлиенте
Функция ПередНачаломСценария() Экспорт
КонецФункции

&НаКлиенте
Функция ПередОкончаниемСценария() Экспорт
КонецФункции

&НаКлиенте
//И Я запоминаю значение переменной среды 'MY_ENV_VAR' в переменную 'ЗначениеПеременнойСреды'
//@ЯЗапоминаюЗначениеПеременнойСредыВПеременную(Парам01, Парам02)
Функция ЯЗапоминаюЗначениеПеременнойСредыВПеременную(ИмяПеременнойСреды, ИмяПеременнойКонтекста) Экспорт
	
	ЗначениеВыражения = "";
	
	ИмяВременногоФайла = ПолучитьИмяВременногоФайла();
	
	Если Ванесса.ЭтоLinux Тогда 
        КомандаСистемы("sh -c 'env | grep ^" + ИмяПеременнойСреды + "= > " + ИмяВременногоФайла + "'");
    Иначе 
        Ванесса.ВыполнитьКомандуОСБезПоказаЧерногоОкна("set " + ИмяПеременнойСреды + " > """ + ИмяВременногоФайла + """");
    КонецЕсли;
	
	Попытка 
		Чтение = Новый ЧтениеТекста(ИмяВременногоФайла);
		Стр = Чтение.ПрочитатьСтроку();
		Пока Стр <> Неопределено Цикл 
			//Найдем ключ и значение
			Индекс = Найти(Стр, "=");
			Если Индекс > 0 Тогда 
				Ключ = Нрег(Лев(Стр, Индекс - 1));
				Если ВРег(Ключ) = ВРег(ИмяПеременнойСреды) Тогда 
					ЗначениеВыражения = Сред(Стр, Индекс + 1);
					Прервать;					
				КонецЕсли;
			КонецЕсли;
			Стр = Чтение.ПрочитатьСтроку();
		КонецЦикла;
	Исключение 
	КонецПопытки;
	
	Ванесса.СохранитьЗначениеПеременнойВКонтекст(ИмяПеременнойКонтекста, ЗначениеВыражения);
КонецФункции
