# Как создать автовидеоинструкцию.

Какой надо установить софт

1. VLC 2.1.5.  [Ссылка](https://www.videolan.org/vlc/releases/2.1.5.html) Версию 2.2 или выше СТАВИТЬ НЕЛЬЗЯ!!!
2. Пакет ImageMagick. [Ссылка](http://www.imagemagick.org/script/download.php) Выбирать пакет, в котором есть "dll", например "ImageMagick-7.0.7-22-Q16-x64-dll.exe". Необходимо прописать путь в Path. Также при установке ImageMagick необходимо обязательно установить флаг "Install legacy utilities (e.g. convert)" , иначе convert.exe не будет установлен.
3. Oscript. [Ссылка](http://oscript.io/downloads) Необходимо прописать путь в Path.
4. (Озвучка от Microsoft. Не обязательно) Для озвучки голосом необходимо установить [Microsoft Speech Platform х32](https://www.microsoft.com/en-us/download/details.aspx?id=27225) и [Server Runtime Languages](https://www.microsoft.com/en-us/download/details.aspx?id=27224) MSSpeech_TTS_ru-RU_Elena или другую голосовую библиотеку. Если не хотите озучивать текст - надо **снять** флаг **Делать озвучку TTS**.
5. (Озвучка от Microsoft. Не обязательно) Также понадобится голосовой движок Балаболка консольный вариант. [Ссылка](http://www.cross-plus-a.ru/bconsole.html) Необходимо прописать путь в Path.
6. (Озвучка от Microsoft. Не обязательно) Если на компьютере нет аудиокарты (настоящей или виртуальной) - озвучка работать не будет из-за особенностей движка TTS.
7. (Озвучка от Yandex. Не обязательно) Нужно зарегистрироваться в [Yandex SpeechKit](https://cloud.yandex.ru/services/speechkit). Также нужно привязать карту. Далее у вас будет 2 месяца триального периода.
8. (Не обязательно) Для отрисовки рамки вокруг активного элемента формы и для перемещения курсора мыши надо скачать UItoolsFor1C.zip [отсюда](https://github.com/Pr-Mex/UItoolsFor1C/releases) и распаковать архив в каталог \vanessa-automation\tools\VideoTools. Если не хотите использовать эти утилиты - тогда надо **снять** флаги **Подсвечивать активные элементы формы** и **Перемещать курсор мышки к активному элементу формы**.
9. Перезагрузиться.
10. Заполнить поля, необходимые для записи видео. Рекомендуется сначала заполнить настройки по умолчанию - на закладке **Автоинструкции** кнопка **Загрузить настройки по умолчанию**.
11. Затем на закладке **Автоинструкции** нажать на кнопку **Проверить что запись видео будет работать** и убедиться в прохождении всех проверок.

Что означают параметры записи.
Чтобы не ломать себе голову какими должны быть настройки - нажмите на кнопку **ЗагрузитьНастройкиПоУмолчанию**. Многие параметры сразу заполнятся как надо.
Скорее всего надо будет изменить путь к команде Convert и каталогу музыки.

1. **Флаг Создавать видеоинструкцию** - если Истина - тогда будет создаваться видео.
2. **Каталог для формирования инструкций Видео** - туда будет выложен результат записи видео - **result.mp4**
3. **Экран ширина** - понятно. Если указать больше чем есть в реальности - то при вызове VLC значение будет приведено к реальному.
4. **Экран высота** - понятно. Если указать больше чем есть в реальности - то при вызове VLC значение будет приведено к реальному.
5. **Количество кадров в секунду** - минимум 5, я ставлю 10. Чем больше кадров тем больше нагружается процессор.
6. **Команда начать запись видео** - вызов VLC для старта записи видео. Да, VLC умеет записывать видео и он управляется по tcp с (помощью OneScript). Поэтому используется именно он. Пример команды: "C:\Program Files (x86)\VideoLAN\VLC\vlc.exe" screen://  -I rc --rc-quiet --rc-host=127.0.0.1:8082 --nommx :screen-mouse-image="<screenmouseimage>" :screen-fps=<fps> :screen-width=<screenwidth> :screen-height=<screenheight> :screen-top=0 :screen-left=0 :screen-caching=100 :sout=#transcode{vcodec=mp4v,vb=400,fps=<fps>,scale=1,width=<screenwidth>,height=<screenheight>,acodec=none}:duplicate{dst=std{access=file,mux=mp4,dst=<dst>}}
7. **Файл курсор мыши** - чтобы на экране было записано движение мыши - надо указать файл в формате png с изображением курсора.
8. **Каталог для временных файлов** - просто каталог где будут формироваться временные файлы. Не должен совпадать с **Каталог для формирования инструкций Видео**. Каталог для временных файлов нужен чтобы потом разобраться что пошло не так, если в видео есть артефакты.
9. **Файл водяной знак** - иконка в формате png, которая появится в правом нижнем углу видео. Если параметр пустой - то лого указываться не будет.
10. **Команда ffmpeg** - как будет вызываться ffmpeg.
11. **Команда Convert** - как будет вызываться Convert из пакета ImageMagic. Необходимо указывать полный путь к exe, т.к. в windows есть своя команда convert. В этом можно убедиться с помощью поиска.
12. **Каталог музыки** - каталог с mp3, которые могут быть взяты в качестве музыкальной подложки. Если параметр пустой - то музыки в видео не будет. Если mp3 в каталоге несколько - то будет выбран случайный трек. Если длительность mp3 меньше длительности видео - тогда трек будет автоматически продлен столько раз, сколько необходимо.
13. **Подсвечивать активные элементы форм** - при изменении элемента формы около него будет рисоваться красная рамка. Перестало работать, начиная с 8.3.12.
14. **Перемещать курсор мышки к активному элементу формы** - при изменении элемента формы к нему будет перемещаться курсор мышки. Перестало работать, начиная с 8.3.12.
15. **Делать озвучку TTS** - флаг того что надо использовать технологию text to speech. Шаги в видео будут озвучены голосом.
16. **Путь к движку TTS** - команда вызова движка, который преобразует текст в wav.
17. **Имя голоса TTS** - часть строки с именем голоса. Например **Elena**. Таким образом можно указать какой голос использовать для озвучки если их много.
18. **Путь к словарю замен** - словарь замен слов или части слов для коррекции произношения. Смотрите пример из Vanessa-Behavior.
19. **Подсветка активного элемента формы** - Начиная с 8.3.13 можно использовать другой механизм подсветки активного элемента формы. Для этого нужно использовать механизм стилей. Подробнее [тут].(https://wonderland.v8.1c.ru/blog/podderzhka-korporativnogo-stilya/)
20. **Чтобы изменить ударение в тексте нужно использовать символ ^. Например: д^ома, или дом^а.
21. **Для работы озвучки от Yandex надо консоли облака Yandex создать каталог и получить его id.
22. **Сообщалось о случаях (один раз), когда для корректной работы программы Arrow (рисующей стрелку на экране) нужно выставить совмесимость Win XP sp3
23. **При использовании шага, рисующего стрелку, лучше избежать в имени файла картинки спецсимволов и национальных кодировок, т.к. имя файла будет передано параметром java приложению, которое может не найти файл с таким именем.
